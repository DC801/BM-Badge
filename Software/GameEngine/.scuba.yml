image: bm-badge:latest

volumes:
        "$PWD/../../..":
                hostpath: "$PWD/../../.."
                options: rw

aliases:
        desktop: compiledb make DESKTOP=1 -j`nproc`
        embedded:
                script:
                        - ln -sf /home/dc801/dev/nordic-sdk15.3.0 "$SCUBA_ROOT/../../.." 2>/dev/null || true
                        - compiledb make EMBEDDED=1 -j`nproc`
                        - unlink "$SCUBA_ROOT/../../../nordic-sdk15.3.0" 2>/dev/null || true
        clean: make cleanall -j`nproc`
        cleanall: make cleanall -j`nproc`
        flash:
                docker_args: --privileged -v /dev:/dev
                script:
                        - ln -sf /home/dc801/dev/nordic-sdk15.3.0 "$SCUBA_ROOT/../../.." 2>/dev/null || true
                        - compiledb make flash EMBEDDED=1 -j`nproc`
                        - unlink "$SCUBA_ROOT/../../../nordic-sdk15.3.0" 2>/dev/null || true
        gdbserver:
                docker_args: --privileged -v /dev:/dev -p 2331:2331
                script:
                        - JLinkGDBServer -device nrf52 -if SWD -speed 4000
        jlink:
                docker_args: --privileged -v /dev:/dev
                script:
                        - JLinkExe -device nrf52 -if SWD -speed 4000 -autoconnect 1
